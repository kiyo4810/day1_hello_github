<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>所得税青色申告決算書 全ページシミュレーター（カンマ区切り対応）</title>
    <style>
      :root {
        --main-green: #2e7d32;
        --bg-light: #f1f8f1;
      }
      body {
        font-family: sans-serif;
        background: #555;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
      }
      .page {
        background: white;
        width: 900px;
        padding: 40px;
        margin-bottom: 30px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
        border: 2px solid var(--main-green);
      }
      h1,
      h2 {
        color: var(--main-green);
        text-align: center;
      }
      .page-num {
        text-align: center;
        font-weight: bold;
        margin-top: 10px;
        border-top: 1px solid #ccc;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 10px;
        table-layout: fixed;
      }
      th,
      td {
        border: 1px solid var(--main-green);
        padding: 5px;
        font-size: 12px;
      }
      th {
        background: var(--bg-light);
      }

      /* 入力欄のスタイル */
      .num-input {
        width: 95%;
        border: none;
        text-align: right;
        font-size: 14px;
        outline: none;
        font-family: monospace;
      }
      input:focus {
        background: #fffde7;
        border-bottom: 1px solid var(--main-green);
      }
      .readonly {
        background: #eee;
        pointer-events: none;
        font-weight: bold;
        color: #000;
      }

      .label {
        background: var(--bg-light);
        width: 180px;
      }
      .num-circle {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 1px solid var(--main-green);
        border-radius: 50%;
        text-align: center;
        font-size: 10px;
        margin-right: 5px;
      }

      .nav-info {
        position: fixed;
        top: 10px;
        left: 10px;
        background: white;
        padding: 10px;
        border-radius: 5px;
        z-index: 100;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      }
    </style>
  </head>
  <body>
    <div class="nav-info">
      <strong>自動計算中</strong><br />
      <small>3桁カンマ区切り対応</small>
    </div>

    <div class="page">
      <h2>所得税青色申告決算書（一般用）- 損益計算書 [cite: 1]</h2>
      <table>
        <tr>
          <th colspan="2">科 目 [cite: 9]</th>
          <th>金 額 [cite: 11]</th>
          <th colspan="2">科 目</th>
          <th>金 額</th>
        </tr>
        <tr>
          <td class="label"><span class="num-circle">1</span>売上金額 [cite: 12]</td>
          <td></td>
          <td><input type="text" id="p1_f1" class="num-input" oninput="calcAll()" onblur="formatInput(this)" /></td>
          <td class="label" rowspan="4">経費 [cite: 32]</td>
          <td class="label"><span class="num-circle">8</span>租税公課 [cite: 61]</td>
          <td><input type="text" class="num-input exp" oninput="calcAll()" onblur="formatInput(this)" /></td>
        </tr>
        <tr>
          <td class="label" rowspan="5">売上原価 [cite: 6]</td>
          <td class="label"><span class="num-circle">2</span>期首棚卸 [cite: 15]</td>
          <td><input type="text" id="p1_f2" class="num-input" oninput="calcAll()" onblur="formatInput(this)" /></td>
          <td class="label"><span class="num-circle">9</span>荷造運賃 [cite: 62]</td>
          <td><input type="text" class="num-input exp" oninput="calcAll()" onblur="formatInput(this)" /></td>
        </tr>
        <tr>
          <td class="label"><span class="num-circle">3</span>仕入金額 [cite: 19]</td>
          <td><input type="text" id="p1_f3" class="num-input" oninput="calcAll()" onblur="formatInput(this)" /></td>
          <td class="label"><span class="num-circle">10</span>水道光熱費 [cite: 63]</td>
          <td><input type="text" class="num-input exp" oninput="calcAll()" onblur="formatInput(this)" /></td>
        </tr>
        <tr>
          <td class="label"><span class="num-circle">4</span>小計 [cite: 21]</td>
          <td><input type="text" id="p1_f4" class="num-input readonly" /></td>
          <td class="label"><span class="num-circle">11</span>旅費交通費 [cite: 64]</td>
          <td><input type="text" class="num-input exp" oninput="calcAll()" onblur="formatInput(this)" /></td>
        </tr>
        <tr>
          <td class="label"><span class="num-circle">5</span>期末棚卸 [cite: 23]</td>
          <td><input type="text" id="p1_f5" class="num-input" oninput="calcAll()" onblur="formatInput(this)" /></td>
          <td class="label" rowspan="5">...</td>
          <td class="label"><span class="num-circle">12</span>通信費 [cite: 65]</td>
          <td><input type="text" class="num-input exp" oninput="calcAll()" onblur="formatInput(this)" /></td>
        </tr>
        <tr>
          <td class="label"><span class="num-circle">6</span>差引原価 [cite: 25]</td>
          <td><input type="text" id="p1_f6" class="num-input readonly" /></td>
          <td class="label"><span class="num-circle">13</span>広告宣伝費 [cite: 66]</td>
          <td><input type="text" class="num-input exp" oninput="calcAll()" onblur="formatInput(this)" /></td>
        </tr>
        <tr>
          <td colspan="2" class="label"><span class="num-circle">7</span>差引金額 [cite: 27]</td>
          <td><input type="text" id="p1_f7" class="num-input readonly" /></td>
          <td class="label"><span class="num-circle">31</span>雑費 [cite: 81]</td>
          <td><input type="text" class="num-input exp" oninput="calcAll()" onblur="formatInput(this)" /></td>
        </tr>
        <tr style="background: #e8f5e9">
          <td colspan="4" class="label"><span class="num-circle">32</span>計 [cite: 86]</td>
          <td><input type="text" id="p1_f32" class="num-input readonly" /></td>
        </tr>
        <tr>
          <td colspan="4" class="label"><span class="num-circle">33</span>差引金額(7-32) [cite: 87]</td>
          <td><input type="text" id="p1_f33" class="num-input readonly" /></td>
        </tr>
        <tr>
          <td colspan="4" class="label"><span class="num-circle">43</span>控除前所得 [cite: 71]</td>
          <td><input type="text" id="p1_f43" class="num-input readonly" /></td>
        </tr>
        <tr>
          <td colspan="4" class="label"><span class="num-circle">44</span>特別控除額 [cite: 74]</td>
          <td><input type="text" id="p1_f44" class="num-input" value="650,000" oninput="calcAll()" onblur="formatInput(this)" /></td>
        </tr>
        <tr style="background: #c8e6c9">
          <td colspan="4" class="label"><span class="num-circle">45</span>所得金額 [cite: 76]</td>
          <td><input type="text" id="p1_f45" class="num-input readonly" /></td>
        </tr>
      </table>
      <div class="page-num">- 1 - [cite: 91]</div>
    </div>

    <div class="page">
      <h2>月別売上(収入)金額及び仕入金額 [cite: 102, 104]</h2>
      <table>
        <tr>
          <th>月 [cite: 104]</th>
          <th>売上(収入)金額 [cite: 104]</th>
          <th>仕入金額 [cite: 104]</th>
        </tr>
        <tr>
          <td>1月</td>
          <td><input type="text" class="num-input m-sales" oninput="calcAll()" onblur="formatInput(this)" /></td>
          <td><input type="text" class="num-input m-cost" oninput="calcAll()" onblur="formatInput(this)" /></td>
        </tr>
        <tr>
          <td>2月</td>
          <td><input type="text" class="num-input m-sales" oninput="calcAll()" onblur="formatInput(this)" /></td>
          <td><input type="text" class="num-input m-cost" oninput="calcAll()" onblur="formatInput(this)" /></td>
        </tr>
        <tr>
          <td>...12月</td>
          <td><input type="text" class="num-input m-sales" oninput="calcAll()" onblur="formatInput(this)" /></td>
          <td><input type="text" class="num-input m-cost" oninput="calcAll()" onblur="formatInput(this)" /></td>
        </tr>
        <tr class="readonly">
          <td>計 [cite: 104]</td>
          <td><input type="text" id="p2_sales_total" class="num-input readonly" /></td>
          <td><input type="text" id="p2_cost_total" class="num-input readonly" /></td>
        </tr>
      </table>
      <div class="page-num">- 2 - [cite: 115]</div>
    </div>

    <div class="page">
      <h2>貸借対照表 [cite: 131, 132]</h2>
      <div style="display: flex; gap: 20px">
        <table style="width: 50%">
          <tr>
            <th colspan="2">資産の部 [cite: 132]</th>
          </tr>
          <tr>
            <td class="label">現金・預金 [cite: 132]</td>
            <td><input type="text" class="num-input asset" oninput="calcAll()" onblur="formatInput(this)" /></td>
          </tr>
          <tr>
            <td class="label">売掛金 [cite: 132]</td>
            <td><input type="text" class="num-input asset" oninput="calcAll()" onblur="formatInput(this)" /></td>
          </tr>
          <tr>
            <td class="label">棚卸資産 [cite: 132]</td>
            <td><input type="text" id="p4_inventory" class="num-input readonly" /></td>
          </tr>
          <tr style="background: #eee">
            <td>資産合計 [cite: 132]</td>
            <td><input type="text" id="p4_asset_total" class="num-input readonly" /></td>
          </tr>
        </table>
        <table style="width: 50%">
          <tr>
            <th colspan="2">負債・資本の部 [cite: 132]</th>
          </tr>
          <tr>
            <td class="label">買掛金 [cite: 132]</td>
            <td><input type="text" class="num-input debt" oninput="calcAll()" onblur="formatInput(this)" /></td>
          </tr>
          <tr>
            <td class="label">元入金 [cite: 132]</td>
            <td><input type="text" class="num-input debt" oninput="calcAll()" onblur="formatInput(this)" /></td>
          </tr>
          <tr>
            <td class="label">今期所得 [cite: 132]</td>
            <td><input type="text" id="p4_income" class="num-input readonly" /></td>
          </tr>
          <tr style="background: #eee">
            <td>負債資本合計 [cite: 132]</td>
            <td><input type="text" id="p4_debt_total" class="num-input readonly" /></td>
          </tr>
        </table>
      </div>
      <div class="page-num">- 4 - [cite: 143]</div>
    </div>

    <script>
      // 数字をカンマ区切りに変換する関数
      function formatNumber(num) {
        return new Intl.NumberFormat("ja-JP").format(num);
      }

      // カンマを除去して数値に戻す関数
      function parseNumber(str) {
        return parseFloat(str.replace(/,/g, "")) || 0;
      }

      // 入力フォーカスが外れた時にカンマを付ける
      function formatInput(el) {
        const val = parseNumber(el.value);
        el.value = formatNumber(val);
      }

      function setVal(id, val) {
        document.getElementById(id).value = formatNumber(val);
      }

      function calcAll() {
        // --- 2ページ目合計 ---
        let mSales = 0;
        document.querySelectorAll(".m-sales").forEach((el) => (mSales += parseNumber(el.value)));
        setVal("p2_sales_total", mSales);
        document.getElementById("p1_f1").value = formatNumber(mSales);

        let mCost = 0;
        document.querySelectorAll(".m-cost").forEach((el) => (mCost += parseNumber(el.value)));
        setVal("p2_cost_total", mCost);
        document.getElementById("p1_f3").value = formatNumber(mCost);

        // --- 1ページ目計算 ---
        const f1 = parseNumber(document.getElementById("p1_f1").value);
        const f2 = parseNumber(document.getElementById("p1_f2").value);
        const f3 = parseNumber(document.getElementById("p1_f3").value);

        const f4 = f2 + f3;
        setVal("p1_f4", f4);

        const f5 = parseNumber(document.getElementById("p1_f5").value);
        const f6 = f4 - f5;
        setVal("p1_f6", f6);

        const f7 = f1 - f6;
        setVal("p1_f7", f7);

        let expTotal = 0;
        document.querySelectorAll(".exp").forEach((el) => (expTotal += parseNumber(el.value)));
        setVal("p1_f32", expTotal);

        const f33 = f7 - expTotal;
        setVal("p1_f33", f33);
        setVal("p1_f43", f33);

        const f44 = parseNumber(document.getElementById("p1_f44").value);
        const actualDeduction = Math.min(Math.max(0, f33), f44);
        setVal("p1_f45", f33 - actualDeduction);

        // --- 4ページ目連動 ---
        setVal("p4_inventory", f5);
        setVal("p4_income", f33);

        let assetTotal = 0;
        document.querySelectorAll(".asset").forEach((el) => (assetTotal += parseNumber(el.value)));
        assetTotal += f5;
        setVal("p4_asset_total", assetTotal);

        let debtTotal = 0;
        document.querySelectorAll(".debt").forEach((el) => (debtTotal += parseNumber(el.value)));
        debtTotal += f33;
        setVal("p4_debt_total", debtTotal);
      }
    </script>
  </body>
</html>
